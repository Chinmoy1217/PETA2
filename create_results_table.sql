-- PETA Prediction Results Table
-- Stores all predictions made by the PETA model

CREATE TABLE IF NOT EXISTS DT_INGESTION.PETA_PREDICTION_RESULTS (
    -- Prediction Identifier
    PREDICTION_ID VARCHAR(50) PRIMARY KEY,
    PREDICTION_TIMESTAMP TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    
    -- Input Parameters
    POL_CODE VARCHAR(10),
    POD_CODE VARCHAR(10),
    MODE_OF_TRANSPORT VARCHAR(20),
    CARRIER_SCAC_CODE VARCHAR(10),
    DEPARTURE_DATE DATE,
    CONGESTION_LEVEL NUMBER(3,0),
    WEATHER_SEVERITY NUMBER(3,0),
    
    -- Prediction Results
    PREDICTED_HOURS NUMBER(10,2),
    PREDICTED_DAYS NUMBER(10,2),
    ARRIVAL_DATE DATE,
    ARRIVAL_DATETIME TIMESTAMP_NTZ,
    
    -- Model Metadata
    MODEL_VERSION VARCHAR(50) DEFAULT 'Ensemble_v1',
    MODEL_ACCURACY_PCT NUMBER(5,2) DEFAULT 87.0,
    BASE_ETA_DAYS NUMBER(10,2),
    
    -- Routing Info
    ROUTE VARCHAR(100),
    
    -- Audit Fields
    CREATED_BY VARCHAR(100) DEFAULT 'PETA_API',
    CREATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Create index for faster queries
CREATE INDEX IF NOT EXISTS IDX_PETA_RESULTS_ROUTE 
ON DT_INGESTION.PETA_PREDICTION_RESULTS(POL_CODE, POD_CODE, DEPARTURE_DATE);

CREATE INDEX IF NOT EXISTS IDX_PETA_RESULTS_TIMESTAMP 
ON DT_INGESTION.PETA_PREDICTION_RESULTS(PREDICTION_TIMESTAMP);

-- Grant permissions (adjust as needed)
GRANT SELECT, INSERT ON DT_INGESTION.PETA_PREDICTION_RESULTS TO ROLE PUBLIC;
